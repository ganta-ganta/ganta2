<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal File Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fflate/0.7.4/fflate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exif-js/2.3.0/exif.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 8px;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        header p {
            font-size: 1.1rem;
            color: var(--secondary-color);
        }

        .converter-box {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .upload-area {
            flex: 1;
            min-width: 300px;
            padding: 40px 20px;
            text-align: center;
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .upload-area h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .upload-area p {
            margin: 10px 0;
            color: var(--secondary-color);
        }

        .upload-area button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition);
        }

        .upload-area button:hover {
            background-color: #3a56d4;
        }

        .file-info {
            margin-top: 20px;
            text-align: left;
            width: 100%;
            padding: 0 20px;
        }

        .file-info p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: var(--dark-color);
        }

        .settings-panel {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            background: #f8f9fa;
        }

        .format-selector, .quality-control, .compression-control {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        select, input[type="range"], input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        input[type="range"] {
            padding: 0;
            -webkit-appearance: none;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
        }

        .advanced-options {
            margin: 25px 0;
        }

        #advancedBtn {
            background: none;
            border: none;
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 0;
        }

        .advanced-panel {
            display: none;
            padding: 15px;
            background: white;
            border-radius: var(--border-radius);
            margin-top: 10px;
            border: 1px solid #eee;
        }

        .advanced-panel.show {
            display: block;
        }

        .option-group {
            margin-bottom: 15px;
        }

        .resize-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .convert-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .convert-btn:hover {
            background-color: #3a56d4;
        }

        .progress-container {
            width: 100%;
            background-color: #e9ecef;
            border-radius: var(--border-radius);
            margin: 20px 0;
            display: none;
        }

        .progress-bar {
            height: 10px;
            background-color: var(--primary-color);
            border-radius: var(--border-radius);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.9rem;
            color: var(--secondary-color);
            padding: 5px 0;
        }

        .result-area {
            display: none;
            background: white;
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-info {
            flex: 1;
        }

        .result-info h4 {
            margin-bottom: 5px;
        }

        .result-info p {
            font-size: 0.9rem;
            color: var(--secondary-color);
        }

        .download-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .download-btn:hover {
            background-color: #218838;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .feature {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .feature i {
            font-size: 2.5rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .feature h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .copyright {
            text-align: center;
            margin-top: 30px;
            color: var(--secondary-color);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .converter-box {
                flex-direction: column;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-exchange-alt"></i> Universal File Converter</h1>
            <p>Convert between multiple file formats directly in your browser</p>
        </header>

        <main>
            <div class="converter-box">
                <div class="upload-area" id="dropZone">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h3>Drag & Drop Files Here</h3>
                    <p>or</p>
                    <button id="browseBtn">Browse Files</button>
                    <input type="file" id="fileInput" multiple style="display: none;">
                    <div class="file-info" id="fileInfo"></div>
                </div>

                <div class="settings-panel">
                    <div class="format-selector">
                        <label for="outputFormat">Convert To:</label>
                        <select id="outputFormat">
                            <optgroup label="Image Formats">
                                <option value="jpg">JPEG (.jpg)</option>
                                <option value="png">PNG (.png)</option>
                                <option value="webp">WebP (.webp)</option>
                                <option value="gif">GIF (.gif)</option>
                                <option value="bmp">BMP (.bmp)</option>
                                <option value="svg">SVG (.svg)</option>
                                <option value="ico">ICO (.ico)</option>
                            </optgroup>
                            <optgroup label="Document Formats">
                                <option value="pdf">PDF (.pdf)</option>
                                <option value="txt">Plain Text (.txt)</option>
                            </optgroup>
                            <optgroup label="Other Formats">
                                <option value="zip">ZIP Archive (.zip)</option>
                                <option value="json">JSON (.json)</option>
                                <option value="csv">CSV (.csv)</option>
                            </optgroup>
                        </select>
                    </div>

                    <div class="quality-control">
                        <label for="qualityRange">Quality: <span id="qualityValue">85</span>%</label>
                        <input type="range" id="qualityRange" min="1" max="100" value="85">
                    </div>

                    <div class="compression-control">
                        <label for="compressionType">Compression Type:</label>
                        <select id="compressionType">
                            <option value="lossy">Lossy (smaller files)</option>
                            <option value="lossless">Lossless (higher quality)</option>
                        </select>
                    </div>

                    <div class="advanced-options">
                        <button id="advancedBtn">Advanced Options <i class="fas fa-caret-down"></i></button>
                        <div class="advanced-panel" id="advancedPanel">
                            <div class="option-group">
                                <label for="resizeToggle">Resize:</label>
                                <input type="checkbox" id="resizeToggle">
                            </div>
                            <div class="resize-controls">
                                <div>
                                    <label for="width">Width (px):</label>
                                    <input type="number" id="width" min="1" value="800">
                                </div>
                                <div>
                                    <label for="height">Height (px):</label>
                                    <input type="number" id="height" min="1" value="600">
                                </div>
                                <div>
                                    <label for="aspectRatio">Maintain Aspect Ratio:</label>
                                    <input type="checkbox" id="aspectRatio" checked>
                                </div>
                            </div>
                            <div class="option-group">
                                <label for="removeMetadata">Remove Metadata:</label>
                                <input type="checkbox" id="removeMetadata">
                            </div>
                        </div>
                    </div>

                    <button id="convertBtn" class="convert-btn">Convert Now</button>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
                <div class="progress-text" id="progressText">0%</div>
            </div>

            <div class="result-area" id="resultArea"></div>
        </main>

        <footer>
            <div class="features">
                <div class="feature">
                    <i class="fas fa-lock"></i>
                    <h3>Secure Processing</h3>
                    <p>All conversions happen in your browser - no files are uploaded</p>
                </div>
                <div class="feature">
                    <i class="fas fa-infinity"></i>
                    <h3>Unlimited Conversions</h3>
                    <p>Convert as many files as you need without restrictions</p>
                </div>
                <div class="feature">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Fast Processing</h3>
                    <p>Optimized algorithms for quick conversions</p>
                </div>
            </div>
            <p class="copyright">© 2023 Universal File Converter. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const dropZone = document.getElementById('dropZone');
            const browseBtn = document.getElementById('browseBtn');
            const fileInput = document.getElementById('fileInput');
            const fileInfo = document.getElementById('fileInfo');
            const outputFormat = document.getElementById('outputFormat');
            const qualityRange = document.getElementById('qualityRange');
            const qualityValue = document.getElementById('qualityValue');
            const compressionType = document.getElementById('compressionType');
            const advancedBtn = document.getElementById('advancedBtn');
            const advancedPanel = document.getElementById('advancedPanel');
            const convertBtn = document.getElementById('convertBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            const resultArea = document.getElementById('resultArea');
            
            // File handling
            let selectedFiles = [];
            
            // Event Listeners
            browseBtn.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', handleFileSelection);
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#4a6bff';
                dropZone.style.backgroundColor = 'rgba(74, 107, 255, 0.05)';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = '#ccc';
                dropZone.style.backgroundColor = 'transparent';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#ccc';
                dropZone.style.backgroundColor = 'transparent';
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelection({ target: fileInput });
                }
            });
            
            qualityRange.addEventListener('input', () => {
                qualityValue.textContent = qualityRange.value;
            });
            
            advancedBtn.addEventListener('click', () => {
                advancedPanel.classList.toggle('show');
                const icon = advancedBtn.querySelector('i');
                icon.classList.toggle('fa-caret-down');
                icon.classList.toggle('fa-caret-up');
            });
            
            convertBtn.addEventListener('click', convertFiles);
            
            // Functions
            function handleFileSelection(e) {
                selectedFiles = Array.from(e.target.files);
                
                if (selectedFiles.length === 0) return;
                
                let fileListHTML = '<h4>Selected Files:</h4>';
                
                selectedFiles.forEach((file, index) => {
                    const fileSize = formatFileSize(file.size);
                    fileListHTML += `
                        <p>${index + 1}. ${file.name} <span>(${file.type || 'Unknown type'}, ${fileSize})</span></p>
                    `;
                });
                
                fileInfo.innerHTML = fileListHTML;
            }
            
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            async function convertFiles() {
                if (selectedFiles.length === 0) {
                    alert('Please select at least one file to convert.');
                    return;
                }
                
                // Show progress bar
                progressContainer.style.display = 'block';
                progressBar.style.width = '0%';
                progressText.textContent = '0%';
                
                // Hide result area if it was shown before
                resultArea.style.display = 'none';
                
                // Convert files one by one
                const convertedFiles = [];
                
                for (let i = 0; i < selectedFiles.length; i++) {
                    const file = selectedFiles[i];
                    try {
                        // Update progress
                        const progress = Math.round((i / selectedFiles.length) * 100);
                        progressBar.style.width = `${progress}%`;
                        progressText.textContent = `${progress}%`;
                        
                        // Convert the file
                        const convertedFile = await convertSingleFile(file);
                        convertedFiles.push(convertedFile);
                    } catch (error) {
                        console.error(`Error converting ${file.name}:`, error);
                        // Continue with next file even if one fails
                    }
                }
                
                // Complete progress
                progressBar.style.width = '100%';
                progressText.textContent = '100%';
                
                // Show results
                showResults(convertedFiles);
            }
            
            async function convertSingleFile(file) {
                const outputExt = outputFormat.value;
                const quality = qualityRange.value / 100;
                const compression = compressionType.value;
                
                // Get file extension
                const fileNameParts = file.name.split('.');
                const inputExt = fileNameParts.length > 1 ? fileNameParts.pop().toLowerCase() : '';
                
                // Create new filename
                const newFileName = fileNameParts.join('.') + '.' + outputExt;
                
                // Convert based on file type
                let convertedBlob;
                
                if (isImageType(inputExt)) {
                    convertedBlob = await convertImageFile(file, outputExt, quality, compression);
                } else if (outputExt === 'pdf') {
                    convertedBlob = await convertToPdf(file);
                } else if (outputExt === 'txt') {
                    convertedBlob = await convertToText(file);
                } else if (outputExt === 'zip') {
                    convertedBlob = await convertToZip(file);
                } else if (outputExt === 'json') {
                    convertedBlob = await convertToJson(file);
                } else if (outputExt === 'csv') {
                    convertedBlob = await convertToCsv(file);
                } else {
                    throw new Error(`Conversion from ${inputExt} to ${outputExt} not supported`);
                }
                
                return {
                    originalName: file.name,
                    convertedName: newFileName,
                    blob: convertedBlob,
                    size: convertedBlob.size
                };
            }
            
            function isImageType(ext) {
                return ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(ext);
            }
            
            async function convertImageFile(file, outputExt, quality, compression) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const img = new Image();
                        img.onload = function() {
                            // Create canvas for conversion
                            const canvas = document.createElement('canvas');
                            const ctx = canvas.getContext('2d');
                            
                            // Handle resizing if enabled
                            let width = img.width;
                            let height = img.height;
                            
                            if (document.getElementById('resizeToggle').checked) {
                                const targetWidth = parseInt(document.getElementById('width').value);
                                const targetHeight = parseInt(document.getElementById('height').value);
                                const maintainAspect = document.getElementById('aspectRatio').checked;
                                
                                if (maintainAspect) {
                                    const ratio = Math.min(targetWidth / width, targetHeight / height);
                                    width = Math.round(width * ratio);
                                    height = Math.round(height * ratio);
                                } else {
                                    width = targetWidth;
                                    height = targetHeight;
                                }
                            }
                            
                            canvas.width = width;
                            canvas.height = height;
                            
                            // Draw image to canvas
                            ctx.drawImage(img, 0, 0, width, height);
                            
                            // Convert to desired format
                            canvas.toBlob((blob) => {
                                if (!blob) {
                                    reject(new Error('Canvas toBlob failed'));
                                    return;
                                }
                                resolve(blob);
                            }, `image/${outputExt}`, quality);
                        };
                        
                        img.onerror = function() {
                            reject(new Error('Image loading failed'));
                        };
                        
                        img.src = e.target.result;
                    };
                    
                    reader.onerror = function() {
                        reject(new Error('File reading failed'));
                    };
                    
                    reader.readAsDataURL(file);
                });
            }
            
            async function convertToPdf(file) {
                // For images, use canvas to create PDF
                if (file.type.startsWith('image/')) {
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        
                        reader.onload = function(e) {
                            const img = new Image();
                            img.onload = function() {
                                const { jsPDF } = window.jspdf;
                                const pdf = new jsPDF();
                                
                                // Add image to PDF
                                pdf.addImage(img, 'JPEG', 10, 10, 180, 0);
                                
                                // Create blob from PDF
                                const pdfBlob = new Blob(
                                    [pdf.output('blob')], 
                                    { type: 'application/pdf' }
                                );
                                
                                resolve(pdfBlob);
                            };
                            
                            img.onerror = function() {
                                reject(new Error('Image loading failed'));
                            };
                            
                            img.src = e.target.result;
                        };
                        
                        reader.onerror = function() {
                            reject(new Error('File reading failed'));
                        };
                        
                        reader.readAsDataURL(file);
                    });
                }
                // For text files
                else if (file.type === 'text/plain') {
                    const text = await file.text();
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF();
                    
                    // Split text into lines that fit in PDF
                    const lines = pdf.splitTextToSize(text, 180);
                    pdf.text(lines, 10, 10);
                    
                    // Create blob from PDF
                    return new Blob(
                        [pdf.output('blob')], 
                        { type: 'application/pdf' }
                    );
                }
                else {
                    throw new Error('File type not supported for PDF conversion');
                }
            }
            
            async function convertToText(file) {
                if (file.type === 'application/json') {
                    const json = await file.text();
                    return new Blob([json], { type: 'text/plain' });
                }
                else if (file.type === 'text/csv') {
                    const csv = await file.text();
                    return new Blob([csv], { type: 'text/plain' });
                }
                else if (file.type.startsWith('text/')) {
                    return file;
                }
                else {
                    throw new Error('File type not supported for text conversion');
                }
            }
            
            async function convertToZip(file) {
                // In a real app, you might bundle multiple files
                // Here we just create a zip with the single file
                const fileData = await file.arrayBuffer();
                const zipped = fflate.zipSync({
                    [file.name]: new Uint8Array(fileData)
                });
                
                return new Blob([zipped], { type: 'application/zip' });
            }
            
            async function convertToJson(file) {
                if (file.type === 'text/csv') {
                    const csv = await file.text();
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',');
                    const result = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (!lines[i]) continue;
                        const obj = {};
                        const currentline = lines[i].split(',');
                        
                        for (let j = 0; j < headers.length; j++) {
                            obj[headers[j]] = currentline[j];
                        }
                        
                        result.push(obj);
                    }
                    
                    return new Blob([JSON.stringify(result, null, 2)], { type: 'application/json' });
                }
                else if (file.type.startsWith('text/')) {
                    const text = await file.text();
                    return new Blob([JSON.stringify({ content: text }, null, 2)], { type: 'application/json' });
                }
                else {
                    throw new Error('File type not supported for JSON conversion');
                }
            }
            
            async function convertToCsv(file) {
                if (file.type === 'application/json') {
                    const json = await file.text();
                    const data = JSON.parse(json);
                    let csv = '';
                    
                    // Extract headers
                    const headers = Object.keys(data[0] || {});
                    csv += headers.join(',') + '\n';
                    
                    // Add data
                    data.forEach(item => {
                        csv += headers.map(header => item[header]).join(',') + '\n';
                    });
                    
                    return new Blob([csv], { type: 'text/csv' });
                }
                else if (file.type.startsWith('text/')) {
                    const text = await file.text();
                    return new Blob([text], { type: 'text/csv' });
                }
                else {
                    throw new Error('File type not supported for CSV conversion');
                }
            }
            
            function showResults(convertedFiles) {
                if (convertedFiles.length === 0) {
                    resultArea.innerHTML = '<p class="error">No files were successfully converted.</p>';
                    resultArea.style.display = 'block';
                    return;
                }
                
                let resultsHTML = '<h3>Conversion Results</h3>';
                
                convertedFiles.forEach((file, index) => {
                    const originalSize = formatFileSize(file.blob.size);
                    
                    resultsHTML += `
                        <div class="result-item">
                            <div class="result-info">
                                <h4>${file.convertedName}</h4>
                                <p>${originalSize} • ${qualityRange.value}% Quality</p>
                            </div>
                            <button class="download-btn" data-index="${index}">
                                <i class="fas fa-download"></i> Download
                            </button>
                        </div>
                    `;
                });
                
                resultArea.innerHTML = resultsHTML;
                resultArea.style.display = 'block';
                
                // Add download button event listeners
                document.querySelectorAll('.download-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const index = this.getAttribute('data-index');
                        downloadFile(convertedFiles[index]);
                    });
                });
            }
            
            function downloadFile(fileInfo) {
                saveAs(fileInfo.blob, fileInfo.convertedName);
            }
        });
    </script>
</body>
</html>
